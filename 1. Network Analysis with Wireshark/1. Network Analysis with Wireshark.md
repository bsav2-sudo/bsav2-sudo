# 1. Network Analysis with Wireshark

![wiresharkimage](https://github.com/user-attachments/assets/3b9b807c-2c52-4498-9e8e-b389d03e88d3)

### Skills Utilised

<code>Wireshark</code> <code>IPv4</code> <code>TCP</code> <code>UDP</code> <code>Traffic Analysis</code> <code>Traffic Filtering</code> <code>Problem Solving</code> <code>Packet Headers</code> <code>HMTL</code> <code>Network Scanning Techniques</code> <code>CVE Exploits</code>  

## Overview

This project looks at **3** PCAP files obtained from the Wireshark Wiki page. The project demonstrates the understanding of utilising Wireshark and also being able to identify malicious traffic from PCAP files, ranging from small PCAP files to large captured files that have been collated over a number of dates. These PCAP files emulate the scenarios in which Network forensics may be required as evidence as part of an investigation, these range from a vulnerablity being exploited to an emulated recconaisance on a target which is seen in the real world. The ability to be able to identify these as part of a Cybersecurity role is very important, as it can help make firewall and IDS rules that can stop attacks from happening and also be able to determine malicious traffic from normal user traffic.

## PCAP Analysis 

### 11-DAYS-OF-SCAN

Context: This file contains traffic information which is collated over 11 Days - **Suspected Scanning From External Host**
File Size: 29.1 MB
File Name: 2024-08-30-approximately-11-days-of-server-scans-and-probes.pcap
File Type: .pcap
Timeframe: 19/08/2024 to 30/08/2024

#### Start of Analysis

To start this analysis - the first step I took was to find out all the details of the pcap file from the "Statistics" page which is found in <code>Statistics -> Capture File Properties</code>. This allows me to be able to get a brief overview of the PCAP file to identify what type of packet capture it is. The questions I ask myself is, is it a large or small file?  How long was the packet capture taken for? What is the timeframe for this? How many packets were recieved over this time period? 

All of this is answered in the <code>Capture File Properties</code> which is shown below:

![Stats](https://github.com/user-attachments/assets/032a11c9-5348-4c79-b96f-0ca4c99c42b0)

From these statistics there are some things that become very apparent before even touching any of the packets. 

Firstly, this is a very large capture file that has been taken over a long period of time. This defines the approach that I can take towards the packet file, as it is such a long time frame I am going to be looking for network patterns over a long period as we know from the information of the file that I am looking for a suspected scan on a host. 

Secondly, I know that I will need to gain some more information from the file before going into the actual analysis of packets etc. Looking for what protocols are being used heavily is a very good way for me to see what traffic this server is experiencing. So now to do this I will look at <code>Statistics -> Protocol Hierarchy</code>. 

The hierarchy will give an overview of all the protocols used in this pcap file to see which is the most dominant protocol. Looking at the <code>Protocol Hierarchy</code> this is the result:

![Protocol Hierarchy](https://github.com/user-attachments/assets/1d0b3395-1f87-4d4f-8577-4cac3d5733ad)

As I can see from the Hierarchy; TCP (Transmission Control Protocol) is 94.1% of the total packets in this .pcap file, which is somewhat expected as I am dealing with a servers network capture but gives clarification to the fact that I should be keeping in mind that the suspected scanning could be a TCP style scan - as the scan could be underlying within the usual TCP traffic. A small note I have also made is I am dealing with the IPv4 protocol and there is no IPv6 packets which helps me narrow down what I should be looking for. 

It is very interesting to note that the ICMP makes up 4.1% of the packets in the .pcap file.  This may be to allow local network admins to be able to see if the server is up or down by doing simple ping tests or sending other ICMP messages. This could be something that can be part of the investigation to see if there is any suspicious ICMP messages being sent to the server.

Now that I have slightly filtered what I should expect to be looking for in this, there is one last step I want to undertake before looking at the file in full is the <code>Endpoints</code> and <code>Conversations</code> that are taking place in this file which is listed below:

![Endpoints](https://github.com/user-attachments/assets/f68d4e29-c55c-4eba-b592-45eb183a5add)


![Conversations](https://github.com/user-attachments/assets/5405bc39-fdac-41e5-b2de-0e0a6a8386c9)

Gathering the <code>Endpoints</code> and <code>Conversations</code> gives me a little bit more contact to the pcap file that I am working with - and by looking at this data - it is evident that there is once conversation that takes place the most which is something I may want to look at more when going into the pcap further.

>> <p>Conversation Details:</p>
>> <p>MAC A: "64-64-9B-4F-37-00"</p> 
>> <p>MAC B: "00-16-3C-CB-72-42"</p>
>> <p>Packets Sent: 381,462</p>
>> <p>Data Size: 24MB</p>

#### In-Depth Analysis

Now that I have been able to gather some basic informaation which can help me in this investigation, it is time to take an in-depth look at the toolset of Wireshark and trying to find patterns within the network capture that could lead to evidence of a network scan being in progress. From the previous statements, I know that one point of interest was the TCP conversations in the network capture as the TCP conversations make up 94.1% of the total traffic.

If this is to be a TCP scan that has taken place - then I can look at the amount of TCP RST's that have taken place over the whole capture time-period. This is important as when a TCP Scan takes place on a host - the connection is always RST to show if the port is open or closed which is then sent back to the endpoint conducting the scan. Keeping this in mind for the analysis I can look at the capture and filter it to show all the TCP RST's which is displayed below:

![ALL RST'S](https://github.com/user-attachments/assets/bb5ae5f2-33a1-427c-87e5-0a678c0bec97)

Okay, so looking at all the TCP RST's there is a large amount of RST Packets that are sent to and from the server - in fact they make up 52.3% of all the packets in the file. This is a good start as it means I am mostly looking at a TCP Scan being used. But now here comes the larger question, if it is a TCP Scan, what type is it. It could be any of the following:

- TCP Connect Scan
- TCP SYN Scan
- ACK Scan
- Fin Scan
- Null Scan
- Idle Scan

This is where I need to look more at the behaviour of the network and see what the packets sent over time looks like. To be able to see this visually I would love to see this on a graph to be able to visually see packet distribution over time. Luckily Wireshark has a very nice tool called **I/O Graphs** which will allow me to map any filters onto a graph over a specific period of time. great, so let me plot the <code>Total Packets</code> and <code>TCP RST's</code> onto a graph that has the full time period. This is what it looks like:

![Graph - TCP Error Over Time](https://github.com/user-attachments/assets/5cce79a4-0d7c-4f8d-bdfb-018fe19fa891)

This gives me a good starting basis to add more filters later and see if there is any correlation between the TCP RST's I see on the capture file and packets that suggest a TCP Scan type. It would be good to look at the file and see what IP Addresses I am working with for this analysis. From the <code>Conversations</code> statistics I know there quite a lot of conversations that are taking place on IPv4, so determining which IP may be doing the scanning is vital to find. So let me start looking for our scanner. Looking at the data - I think I have found our scanner:

![IP Address of Scanner](https://github.com/user-attachments/assets/c5eaa64e-7bcb-4a8c-bbb0-289d6835d73a)

Seeming as this is the endpoints with the largest conversation it could be possible - but I need to be able to back this up with further evidence. Seeing as though I have seen this is a TCP Scan, I'm going to try and narrow it down to one possible scan being used.

So firstly, applying the IP Address as a filter, I am getting two different packets back - RST and SYN. This is interesting as this may suggest I am looking at a TCP SYN scan in which the only replys our server will be sending to the scanning endpoint is SYN ACK or RST (telling the scanner if the port is opem or not).Seeing the screenshot below adds the evidence to this:

![SYN and RST](https://github.com/user-attachments/assets/2b0315c9-83f1-4e66-bfab-cd724f27121c)

Now in order to confirm this is a TCP SYN scan that has taken place I'm going to do two more things - one of them is going to take a closer look at some of the TCP SYN packets that have been sent to see what the packet looks like - does it have any data? Does the packet look malformed or contain interesting information. I'm going to have a look:

![SYN FLOOD](https://github.com/user-attachments/assets/3e240dd6-ffb0-4fc2-a228-249c3997be6e)

Looking at this SYN packet I can see that I am definetly looking at a SYN packet amd there doesn't seem to be anything that looks malicious or suspicious about the packets being sent - but that doesn't make me doubt this is a TCP SYN scan on this server, so the next thing I am going to do is go back to my I/O graph from earlier but plot a new line for the TCP SYN packets that are sent over the 10 day period. If there is any correlation to the TCP Errors (RST Packets) then this can add more evidence to this scan. And sure enough once I add my extra plot into the graph - there is a correlation:

![SYN over time](https://github.com/user-attachments/assets/7715009e-6819-402b-99b4-717fedfbff38)

Success! I can confirm what type of scan has occured on this server - and since reading more documentation on Wireshark - there is one more mode I can use to confirm this. <code>Expert Mode</code> can let me see what Warnings and Errors Wireshark finds within this .pcap file - so lets see what I get:

![Expert Info](https://github.com/user-attachments/assets/564860e4-a2e6-4934-b24c-4aeba67f0048)

Looking at the TCP errors and warnings that Wireshark has gave in Expert Mode - this confirms the traits of a TCP SYN Scan including the TCP RST'S, Zero Windows Segment in TCP Packets and more.

Now that I can see the scan that has been done, how would I mitgate this scan from happening in future?

#### Mitigate against a TCP SYN Scan

One of the ways to be able to mitigate against this style of scan is by setting up <code>some robust and strong filtering rules on the IDS/IPS or Firewall</code>- this will allow for the network to be able to alert or drop packets that it would suspect are those from a TCP SYN Scan. The most effective way to do this in my opinion would be to set a rule that alerts the network admin when a thershold is met of TCP SYN and RST packets have been sent and recieved from a single external IP Addresss - this is because as part of normal network traffic TCP SYN packets take place most of the time to be able to start connections - however these send SYN ACK and ACK packets when the connection is established, not RST packets in a short amount of time to show the port is closed.

Another way to be able to mitigate from this type of scan is to <code>block known malicious IP Addresses</code> - this a basic yet effective strategy as it the network will block these IP Addresses from being able to communicate over the network and so stopping scans from happening from untrusted IP Addresses.

Furthermore - one of the other possible ways to mitigate this scan from taking place is by having <code>rate-limiting implemented on the network from incoming connection requests</code>. This can be considered the "threshold" for the incoming connections to the network and limits the ammount of incoming connections allowed on the network. The reverse of this would be also adding more backlog to the server or network so that when SYN packets are sent over the network, a server is able to handle all the SYN packets it receieves.

### TCP_SYN_SCAN


Context:

### EXPLOIT_METASPLOIT_CVE2012_1723


Context:

## Outcomes of Investigation







